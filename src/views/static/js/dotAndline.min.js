(function(window,document){function Dotline(option){this.opt=this.extend({dom:"J_dotLine",cw:1000,ch:500,ds:100,r:0.5,dis:100},option);this.c=document.getElementById(this.opt.dom);this.ctx=this.c.getContext("2d");this.c.width=this.opt.cw;this.c.height=this.opt.ch;this.dotSum=this.opt.ds;this.radius=this.opt.r;this.disMax=this.opt.dis*this.opt.dis;this.dots=[];var RAF=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(callback){window.setTimeout(callback,1000/60)};var _self=this;var mousedot={x:null,y:null,label:"mouse"};this.c.onmousemove=function(e){var e=e||window.event;mousedot.x=e.clientX-_self.c.offsetLeft;mousedot.y=e.clientY-_self.c.offsetTop};this.c.onmouseout=function(e){mousedot.x=null;mousedot.y=null};this.animate=function(){_self.ctx.clearRect(0,0,_self.c.width,_self.c.height);_self.drawLine([mousedot].concat(_self.dots));RAF(_self.animate)}}Dotline.prototype.extend=function(o,e){for(var key in e){if(e[key]){o[key]=e[key]}}return o};Dotline.prototype.addDots=function(){var dot;for(var i=0;i<this.dotSum;i++){dot={x:Math.floor(Math.random()*this.c.width)-this.radius,y:Math.floor(Math.random()*this.c.height)-this.radius,ax:(Math.random()*2-1)/1.5,ay:(Math.random()*2-1)/1.5};this.dots.push(dot)}};Dotline.prototype.move=function(dot){dot.x+=dot.ax;dot.y+=dot.ay;dot.ax*=(dot.x>(this.c.width-this.radius)||dot.x<this.radius)?-1:1;dot.ay*=(dot.y>(this.c.height-this.radius)||dot.y<this.radius)?-1:1;this.ctx.beginPath();this.ctx.arc(dot.x,dot.y,this.radius,0,Math.PI*2,true);this.ctx.stroke()};Dotline.prototype.drawLine=function(dots){var nowDot;var _that=this;this.dots.forEach(function(dot){_that.move(dot);for(var j=0;j<dots.length;j++){nowDot=dots[j];if(nowDot===dot||nowDot.x===null||nowDot.y===null){continue}var dx=dot.x-nowDot.x,dy=dot.y-nowDot.y;var dc=dx*dx+dy*dy;if(Math.sqrt(dc)>Math.sqrt(_that.disMax)){continue}if(nowDot.label&&Math.sqrt(dc)>Math.sqrt(_that.disMax)/2){dot.x-=dx*0.02;dot.y-=dy*0.02}var ratio;ratio=(_that.disMax-dc)/_that.disMax;_that.ctx.beginPath();_that.ctx.lineWidth=ratio/2;_that.ctx.strokeStyle="rgba(0,0,0,"+(ratio+0.2)+")";_that.ctx.moveTo(dot.x,dot.y);_that.ctx.lineTo(nowDot.x,nowDot.y);_that.ctx.stroke()}})};Dotline.prototype.start=function(){var _that=this;this.addDots();setTimeout(function(){_that.animate()},100)};window.Dotline=Dotline}(window,document));